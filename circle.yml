machine:
  node:
    version: "5.1.0"

dependencies:
  cache_directories:
    - node_modules
    - bower_components
  override:
    - npm prune && npm install
    - bower prune && bower install
    - git config user.name "circleci"
    - git config user.email "circleci@bellycard.com"

test:
  override:
    - ./node_modules/.bin/gulp test

deployment:
  staging:
    branch: development
    commands:
      - ./node_modules/.bin/gulp ci --env staging
      - ./node_modules/.bin/gulp build --env staging
      - ./node_modules/.bin/gulp deploy --env staging

  production:
    branch: master
    commands:
      - ./node_modules/.bin/gulp ci --env production
      - ./node_modules/.bin/gulp build --env production
      - ./node_modules/.bin/gulp release
      - ./node_modules/.bin/gulp deploy --env production
