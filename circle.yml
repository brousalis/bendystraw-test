machine:
  node:
    version: "5.1.0"

dependencies:
  cache_directories:
    - node_modules
    - bower_components
  override:
    - npm install
    - bower install
    - git config user.name "circleci"
    - git config user.email "circleci@bellycard.com"

test:
  override:
    - ./node_modules/.bin/gulp test

deployment:
  staging:
    branch: development
    commands:
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp ci --env staging ; fi
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp build --env staging ; fi
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp deploy --env staging ; fi

  production:
    branch: master
    commands:
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp ci --env production ; fi
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp build --env production ; fi
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp release ; fi
      - if [[ ! -z $CI_PULL_REQUEST ]] ; then ./node_modules/.bin/gulp deploy --env production ; fi
